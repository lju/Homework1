<html>
<canvas id="myCanvas" width="400" height="400"
        style="border:1px solid #000000;">
</canvas>
<script>

var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");

var ship = new Object();
ship.left = 200;
ship.top = 200;
ship.direction = "up";
ship.velocity = 0;
ship.width = 20;
ship.height = 20;

var Bullets = new Array();

//var bullet = new Object();
//bullet.left;
//bullet.top;

function bullet(left, top, size, velocity, direction)
{
	this.left = left;
	this.top = top;
	this.size = size;
	this.velocity = velocity;
	this.direction = direction;
}

ship.shoot = function() {
	if (ship.direction === "up") {
		//ctx.fillRect((ship.left + 6), (ship.top - 8), 8, 8);
		//bullet.left = ship.left + 6;
		//bullet.top = ship.top - 8;
		var shipLeft = ship.left + 6;
		var shipTop = ship.top - 8;
		Bullets.push(new bullet(shipLeft, shipTop, 8, 1, "up"));
		//drawGame();
	}
	
	if (ship.direction === "left") {
		//ctx.fillRect((ship.lef  t - 8), (ship.top + 6), 8, 8);
		//bullet.left = ship.left  - 8;
		//bullet.top = ship.top + 6;
		Bullets.push(new bullet((ship.left-8), (ship.top+6), 8, 1, "left"));
		//drawGame();
	}
	
	if (ship.direction === "down") {
		//ctx.fillRect((ship.left + 6), (ship.top + 20), 8, 8);
		//bullet.left = ship.left + 6;
		//bullet.top = ship.top + 20;
		Bullets.push(new bullet((ship.left+6), (ship.top+ship.width), 8, 1, "down"));
		//drawGame();
	}
	
	if (ship.direction === "right") {
		//ctx.fillRect((ship.left + 20), (ship.top + 6), 8, 8);
		//bullet.left = ship.left + ship.width;
		//bullet.top = ship.top + 6;
		Bullets.push(new bullet((ship.left+ship.width), (ship.top+6), 8, 1, "right"));
		//drawGame();
	}
}

ctx.fillRect(ship.left, ship.top, ship.width, ship.height);

function drawGame() {
	ctx.clearRect(0, 0, 400, 400);
	ctx.fillRect(ship.left, ship.top, ship.width, ship.height);
	//console.log(String(Bullets.length));
	for (var i = 0; i < Bullets.length; i++)
	{
		//console.log("direction" + String(Bullets[i].direction));
		if (Bullets[i].left + ship.width < 0 || Bullets[i].left > 400 ||
			Bullets[i].top + ship.height < 0 || Bullets[i].top > 400)
		{
			Bullets.splice(i,1);
			continue;
		}
		
		ctx.fillRect(Bullets[i].left, Bullets[i].top, Bullets[i].size, Bullets[i].size);
		
		switch(Bullets[i].direction) {
			case "up":
			//console.log("up");
			Bullets[i].top -= Bullets[i].velocity;
			break;
		
			case "down":
			//console.log("down");
			Bullets[i].top += Bullets[i].velocity;
			break;
		
			case "left":
			//console.log("left");
			Bullets[i].left -= Bullets[i].velocity;
			break;
		
			case "right":
			//console.log("right");
			Bullets[i].left += Bullets[i].velocity;
			break;
		}
	}
}

// Movement... diagonal?
function onKeyDown(event) {
	if (event.keyCode === 37) {
		ship.direction = "left";
		drawGame(--ship.left, ship.top);
	}
	
	if (event.keyCode === 38) {
		//alert(String(Bullets.length));
		ship.direction = "up";
		drawGame(ship.left, --ship.top);
	}
	
	if (event.keyCode === 39) {
		ship.direction = "right";
		drawGame(++ship.left, ship.top);
	}
	
	if (event.keyCode === 40) {
		ship.direction = "down";
		drawGame(ship.left, ++ship.top);
	}
	
	if (event.keyCode === 32) {
		ship.shoot(ship.direction, ship.left, ship.top);
	}
}

function run() {
	canvas.addEventListener('keydown', onKeyDown, false);

	// make canvas focusable, then give it focus!
	canvas.setAttribute('tabindex','0');
	canvas.focus();
	setInterval(drawGame, 50);
}

run();

</script>
</html>